CREATE DATABASE DBMS_16C;
USE DBMS_16C;

CREATE TABLE STUD21(ROLL INT PRIMARY KEY,ATT INT NOT NULL,STATUS VARCHAR(10));
CREATE TABLE D_STUD(ROLL INT NOT NULL,ATT INT NOT NULL,STATUS VARCHAR(10));

INSERT INTO STUD21 (ROLL,ATT) VALUES (1,78);
INSERT INTO STUD21 (ROLL,ATT) VALUES (2,58);
INSERT INTO STUD21 (ROLL,ATT) VALUES (3,76);
INSERT INTO STUD21 (ROLL,ATT) VALUES (4,66);
INSERT INTO STUD21 (ROLL,ATT) VALUES (5,56);
INSERT INTO STUD21 (ROLL,ATT) VALUES (6,88);

SELECT * FROM STUD21;

DELIMITER $
CREATE PROCEDURE ATT()
BEGIN
DECLARE DONE INT DEFAULT FALSE;
DECLARE ATTENDANCE INT;
DECLARE R_NO INT;
DECLARE C1 CURSOR FOR SELECT ROLL,ATT FROM STUD21 WHERE ATT<75;
DECLARE CONTINUE HANDLER FOR NOT FOUND SET DONE = TRUE;
OPEN C1;
R_LOOP: LOOP
FETCH C1 INTO R_NO,ATTENDANCE;
IF DONE THEN
LEAVE R_LOOP;
END IF;
UPDATE STUD21 SET STATUS="D" WHERE ROLL=R_NO;
INSERT INTO D_STUD VALUES(R_NO,ATTENDANCE,"D");
END LOOP R_LOOP;
CLOSE C1;
END$
DELIMITER ;

CALL ATT;

SELECT * FROM STUD21;
SELECT * FROM D_STUD;
